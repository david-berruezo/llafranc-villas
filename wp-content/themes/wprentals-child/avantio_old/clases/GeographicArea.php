<?phpclass GeographicArea{    protected $table      = 'dynamic_geocountry';    protected $primaryKey = 'id';    protected $allowedFields = ['id', 'language','text_title'];    private $vector_found = array(        "Not s",        "Non s",        "Sin e",        "Not specified",        "Sin especificar",    );    # wordpress    private $post_id;    public function insertGeographicAreas($xml,$avantio_credentials)    {        $wpdb = Database::getInstance();        foreach($xml->InternationalizedItem as $country){            $lang = (string)$country->Language;            if(!in_array($lang,$avantio_credentials['ACTIVED_LANGUAGES'])) continue;            $country_name = (string)$country->Countries->Country->Name;            if ($country_name == "España"){            $country_id = intval($country->Countries->Country->CountryCode);            # geocountry            foreach($country->Countries->Country->Regions->Region as $region){                $region_term = "";                $region_name = (string)$region->Name;                $region_id = intval($region->RegionCode);                # insert term if not exist | update term if exist and parent                $actions = array(                    $region_name                );                foreach ($actions as $key) {                    $my_cat = array(                        'description' => $key,                        'slug' =>sanitize_title($key),                        'parent' => 0                    );                    $my_term_id = term_exists($key, 'property_city', $my_cat);                    if(!$my_term_id){                        $region_term =  wp_insert_term($key, 'property_city', $my_cat);                    }else{                        $region_term =  get_term($my_term_id["term_id"],'property_city' , 'array');                    }                }                # add option save cityparent category_fetured_image and others                $term_data = array(                    "pagetax" => "",                    "category_featured_image" => "http://localhost/brava_rentals/wp-content/uploads/importedmedia/blogmedia-361789.jpg",                    "category_tax" => "property_city"                );                if(is_array($region_term))                    $taxonomy = "taxonomy_".$region_term["term_id"];                if(is_object($region_term))                    $taxonomy = "taxonomy_".$region_term->term_id;                $return = add_option($taxonomy, $term_data, $deprecated = '', $autoload = 'yes' );                /*                echo "city el term id es<br>";                print_r($region_term);                $sql="INSERT INTO dynamic_georegion (id,language,text_title,dynamic_geocountry,status) VALUES ('".$region_id."','".$lang."','".$db->escapeString($region_name)."','".$country_id."', 'ACTIVED') ON DUPLICATE KEY UPDATE text_title='".$db->escapeString($region_name)."' ;";                if (!$db->query($sql)){                    $error = $db->error();                    echo "Error " . $error["code"] . " con la descripción " . $error["message"];                    die();                }// end if                */                foreach($region->Cities->City as $city){                    $city_name = (string)$city->Name;                    $city_id = intval($city->CityCode);                    # insert term if not exist | update term if exist and parent                    $actions = array(                        $city_name                    );                    foreach ($actions as $key) {                        $my_cat = array(                            'description' => $key,                            'slug' =>sanitize_title($key),                            'parent' => (is_object($region_term)) ? $region_term->term_id : $region_term["term_id"]                        );                        $my_term_id = term_exists($key, 'property_city', $my_cat);                        if(!$my_term_id){                            $city_term =  wp_insert_term($key, 'property_city', $my_cat);                        }else{                            $city_term =  get_term($my_term_id["term_id"],'property_city' , 'array');                            $city_term->parent = $region_term->term_id;                            wp_update_term( $city_term->term_id,'property_city', $args = array() );                        }                    }                    # add option save cityparent category_fetured_image and others                    $term_data = array(                        "pagetax" => "",                        "category_featured_image" => "http://localhost/brava_rentals/wp-content/uploads/importedmedia/blogmedia-361789.jpg",                        "category_tax" => "property_city"                    );                    if(is_array($city_term))                        $taxonomy = "taxonomy_".$city_term["term_id"];                    if(is_object($city_term))                        $taxonomy = "taxonomy_".$city_term->term_id;                    $return = add_option($taxonomy, $term_data, $deprecated = '', $autoload = 'yes' );                    /*                    echo "city el term id es<br>";                    print_r($city_term);                    $sql="INSERT INTO dynamic_geocity (id,language,text_title,dynamic_georegion,status) VALUES ('".$city_id."','".$lang."','".$db->escapeString($city_name)."','".$region_id."', 'ACTIVED') ON DUPLICATE KEY UPDATE text_title='".$db->escapeString($city_name)."' ;";                    if (!$db->query($sql)){                        $error = $db->error();                        echo "Error " . $error["code"] . " con la descripción " . $error["message"];                        die();                    }// end if                    */                    foreach($city->Localities->Locality as $locality){                        $locality_name = (string)$locality->Name;                        $locality_id = intval($locality->LocalityCode);                        # insert term if not exist | update term if exist and parent                        $actions = array(                            $locality_name                        );                        foreach ($actions as $key) {                            $my_cat = array(                                'description' => $key,                                'slug' =>sanitize_title($key)                            );                            $my_term_id = term_exists($key, 'property_area', $my_cat);                            if(!$my_term_id){                                $area_term = wp_insert_term($key, 'property_area', $my_cat);                            }else{                                $area_term =  get_term($my_term_id["term_id"],'property_area' , 'array');                            }                        }                        $area_parent = $area_term;                        # add option save cityparent category_fetured_image and others                        $term_data = array(                            "cityparent" => $city_name,                            "pagetax" => "",                            "category_featured_image" => "http://localhost/brava_rentals/wp-content/uploads/importedmedia/blogmedia-361789.jpg",                            "category_tax" => "property_area"                        );                        if(is_array($area_term))                            $taxonomy = "taxonomy_".$area_term["term_id"];                        if(is_object($area_term))                            $taxonomy = "taxonomy_".$area_term->term_id;                        $return = add_option($taxonomy, $term_data, $deprecated = '', $autoload = 'yes' );                        /*                        echo "area el term id es<br>";                        print_r($area_term);                        $sql = "INSERT INTO dynamic_geolocality (id,language,text_title,dynamic_geocity,status) VALUES ('".$locality_id."','".$lang."','".$db->escapeString($locality_name)."','".$city_id."', 'ACTIVED') ON DUPLICATE KEY UPDATE text_title='".$db->escapeString($locality_name)."' ;";                        if (!$db->query($sql)){                            $error = $db->error();                            echo "Error " . $error["code"] . " con la descripción " . $error["message"];                            die();                        }// end if                        */                        foreach($locality->Districts->District as $district){                            if(!in_array($district->Name, $this->vector_found)){                                if(strpos((string)$district->Name,"Sin especificar") !== true && strpos((string)$district->Name,"Not specified") !== true && strpos((string)$district->Name,"Not specified") !== true){                                    $district_name = (string)$district->Name;                                    $district_id = intval($district->DistrictCode);                                    $district_postal_code = intval($district->PostalCode);                                    # insert term if not exist | update term if exist and parent                                    $actions = array(                                        $district_name                                    );                                    foreach ($actions as $key) {                                        $my_cat = array(                                            'description' => $key,                                            'slug' =>sanitize_title($key),                                            'parent' => (is_object($area_parent)) ? $area_parent->term_id : $area_parent["term_id"]                                        );                                        $my_term_id = term_exists($key, 'property_area', $my_cat);                                        if(!$my_term_id){                                            $area_term = wp_insert_term($key, 'property_area', $my_cat);                                        }else{                                            $area_term =  get_term($my_term_id["term_id"],'property_area' , 'array');                                            wp_update_term( $area_term->term_id,'property_area', $args = array() );                                        }                                    }                                    # add option save cityparent category_fetured_image and others                                    $term_data = array(                                        "cityparent" => $city_name,                                        "pagetax" => "",                                        "category_featured_image" => "http://localhost/brava_rentals/wp-content/uploads/importedmedia/blogmedia-361789.jpg",                                        "category_tax" => "property_area"                                    );                                    if(is_array($area_term))                                        $taxonomy = "taxonomy_".$area_term["term_id"];                                    if(is_object($area_term))                                        $taxonomy = "taxonomy_".$area_term->term_id;                                    $return = add_option($taxonomy, $term_data, $deprecated = '', $autoload = 'yes' );                                    /*                                    echo "area el term id es<br>";                                    print_r($area_term);                                    $sql="INSERT INTO dynamic_geodistrict (id,language,text_title,dynamic_geolocality,text_postalcode,status) VALUES ('".$district_id."','".$lang."','".$db->escapeString($district_name)."','".$locality_id."','".$db->escapeString($district_postal_code)."', 'ACTIVED') ON DUPLICATE KEY UPDATE text_title='".$db->escapeString($district_name)."', text_postalcode='".$db->escapeString($district_postal_code)."' ;";                                    if (!$db->query($sql)){                                        $error = $db->error();                                        echo "Error " . $error["code"] . " con la descripción " . $error["message"];                                        die();                                    }// end if                                    */                                }// end if                            } // end if                        }// end foreach                    }// end foreach                }// end foreach            }// end foreach            }// end if        }// end foreach    } // end function    private function add_two_primary_keys()    {        $forge = \Config\Database::forge();        $forge->addKey('id', TRUE);        $forge->addKey('language', TRUE);    } // end function    private function insertar_actualizar()    {        $data = [            'id'            => "",            'language'      => "",            'text_title'    => ""        ];        $this->save($data);    } // end function}// end class?>