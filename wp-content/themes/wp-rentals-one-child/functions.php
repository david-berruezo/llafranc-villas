<?php// Exit if accessed directlyif ( !defined( 'ABSPATH' ) ) exit;# constantsdefine("app_child_url", __DIR__);# var$db = "";// $avantio_credential = "local_wordpress";// $avantio_credential = "servidor_dani";$avantio_credential = "servidor";$services = "";$actual_language = "";# includesinclude(app_child_url . "/Clases/Database.php");# helpersinclude(app_child_url . "/helpers/funciones.php");include(app_child_url . "/helpers/funciones_wordpress.php");$actual_url = full_url($_SERVER);# stylesif ( !function_exists( 'wpestate_chld_thm_cfg_parent_css' ) ):    function wpestate_chld_thm_cfg_parent_css() {        $parent_style = 'wpestate_style';        wp_enqueue_style('bootstrap',get_template_directory_uri().'/css/bootstrap.css', array(), '1.0', 'all');        wp_enqueue_style('bootstrap-theme',get_template_directory_uri().'/css/bootstrap-theme.css', array(), '1.0', 'all');        wp_enqueue_style( $parent_style, get_template_directory_uri() . '/style.css',array('bootstrap','bootstrap-theme'),'all' );        wp_enqueue_style( 'wpestate-child-style',            get_stylesheet_directory_uri() . '/style.css',            array( $parent_style ),            wp_get_theme()->get('Version')        );        //wp_enqueue_style( 'select2-child-style', get_stylesheet_directory_uri() . '/css/select2.min.css', array(), wp_get_theme()->get('Version') );        wp_enqueue_style( 'bootstrap-select-child-style', get_stylesheet_directory_uri() . '/css/bootstrap-select.min.css', array(), wp_get_theme()->get('Version') );    }endif;add_action( 'init', 'check_post_thumbnail' );# check post thumbnailsif ( !function_exists( 'check_post_thumbnail' ) ):    function check_post_thumbnail(){        $args = array(            "post_type" => "estate_property",            'numberposts' => -1        );        $propiedades = get_posts($args);        foreach ($propiedades as $propiedad){            //echo $propiedad->ID . "<BR>";            if (has_post_thumbnail($propiedad) == false){                $attachments = get_posts(array(                    'post_type' => 'attachment',                    'post_mime_type'=>'image',                    'posts_per_page' => 0,                    'post_parent' => $propiedad->ID,                    'order'=>'ASC',                ));                if ($attachments) {                    foreach ($attachments as $attachment) {                        $image = wp_get_attachment_image( $attachment->ID, "thumbnail", false, '' );                        $image_url = wp_get_attachment_image_url($attachment->ID,"thumbnail",false);                        if ($image){                            set_post_thumbnail($propiedad->ID, $attachment->ID);                            break;                        }                    }                    // display the featured image                    the_post_thumbnail();                }            }        }    }endif;add_action( 'wp_enqueue_scripts', 'wpestate_chld_thm_cfg_parent_css' );# languageload_child_theme_textdomain('wprentals', get_stylesheet_directory().'/languages');// END ENQUEUE PARENT ACTION# javascriptadd_action( 'wp_enqueue_scripts', 'wp_enqueue_scripts_brava' );function wp_enqueue_scripts_brava() {    wp_enqueue_script('custom-script', get_stylesheet_directory_uri() . '/js/script.js', array( 'jquery' ));    // wp_enqueue_script('select-script', get_stylesheet_directory_uri() . '/js/select2.min.js', array( 'jquery' ));    wp_enqueue_script('bootstrap-select', get_stylesheet_directory_uri() . '/js/bootstrap-select.min.js', array( 'jquery' ));}# connect to database functionfunction connect_two_db(){    global $db , $avantio_credential;    $connector = new Database();    $connector->setCredential($avantio_credential);    $db = $connector::getInstance();}# call connect to database function// connect_two_db();$actual_language = "";add_action("init","guardar_language");function guardar_language(){    global $actual_language;    # get actual_language    $actual_language = pll_current_language();}/** * cargamos propiedades a la lista * de la home */function load_properties(){    $args = array(        'post_type' => 'estate_property',        'lang' => $_GET["lang"],        'post_status' => 'publish',        'numberposts' => -1,        'orderby' => 'post_title',        'order' => 'asc'        //'meta_key' => 'guest_no',        //'meta_value' => '',        //'compare' => '!='    );    $properties = get_posts($args);    $res = array("language" => $_GET["lang"] , "properties" => $properties );    echo json_encode($res,true);    die();}add_action('wp_ajax_nopriv_load_properties', 'load_properties');add_action('wp_ajax_load_properties', 'load_properties');add_action("init","add_footer");function add_footer(){    // $shortcode = "[elementor-template id=\"371106\"]";    // add_shortcode($shortcode);    // delete_all_terms( 'property_piscina');    // unregister_taxonomy( 'property_piscina');}# add_action("init","delete_video");# link de mostrar casa# https://www.youtube.com/watch?v=AzJ6dyGZbRcfunction delete_video(){    $args = array(        'post_type' => 'estate_property',        "numberposts" => -1    );    $posts = get_posts($args);    foreach ($posts as $post) {        update_post_meta($post->ID, 'embed_video_type', 0, $prev_value = '');        update_post_meta($post->ID, 'embed_video_id', "", $prev_value = '');        update_post_meta($post->ID, 'virtual_tour', "", $prev_value = '');    } // end foreach}check_desabilitados();function check_desabilitados(){    # conneciton    //$instance_two = new wpdb('tiendapi_user','Perretin771','tiendapi_inmobiliaria_dos','localhost');    //$instance_one = new wpdb('tiendapi_user','Perretin771','tiendapi_inmobiliaria','localhost');    $instance_one = new wpdb('root','Berruezin23','tiendapi_inmobiliaria','localhost:3306');    $instance_two = new wpdb('root','Berruezin23','tiendapi_inmobiliaria_online','localhost:3306');    # obtenemos    $sql = " SELECT id FROM avantio_accomodations WHERE language = 'es' ";    $acommodations = $instance_one->get_results($sql);    $sql = " SELECT ID FROM wp_posts WHERE post_type = 'estate_property' AND post_status = 'publish' ";    $properties = $instance_two->get_results($sql);    $vector_no_encontrados = array();    foreach ($properties as $property) {        $digitos = (string)$property->ID;        $numero  = $digitos[0].$digitos[1].$digitos[2].$digitos[3].$digitos[4].$digitos[5];        $encontrado_numero = false;        foreach ($acommodations as $acommodation) {            if ($acommodation->id == $numero){                $encontrado_numero = true;                break(1);            }        }        if (!$encontrado_numero)            array_push($vector_no_encontrados,$digitos);    }    foreach ($vector_no_encontrados as $vector_no_encontrado) {        if ($_SERVER["REMOTE_ADDR"] == "79.153.18.148"){            //echo $vector_no_encontrado . "<br>";        }        # update        $query = $instance_two->prepare("UPDATE wp_posts set post_status = 'draft' WHERE ID = $vector_no_encontrado ");        $instance_two->query($query);    }}function borrar_posts_inactivos(){    $sql = " SELECT (SUBSTRING(ID, Length(id)-2, 3)) as digito , wp_posts.ID FROM wp_posts WHERE post_type = 'estate_property' AND post_title <> ''AND (SUBSTRING(ID, Length(ID)-2, 3) <> 101 AND SUBSTRING(ID, Length(id)-2, 3) <> 201 AND SUBSTRING(ID, Length(id)-2, 3) <> 401) AND ID NOT in(SELECT id FROM tiendapi_inmobiliaria.avantio_accomodations WHERE LANGUAGE = 'es')order by ID DESC ";    //$instance_one = new wpdb('root','Berruezin23','tiendapi_inmobiliaria','localhost:3306');    //$instance_two = new wpdb('root','Berruezin23','tiendapi_inmobiliaria_online','localhost:3306');}# borramos posts identificdores Indonesia ...// borrar_post();function borrar_post(){    # conneciton    $instance = new wpdb('tiendapi_user','Perretin771','tiendapi_inmobiliaria_dos','localhost');    # id_number    $number_to_put_in_like = 442;    # test one    $query = $instance->prepare("DELETE FROM wp_posts WHERE post_type = 'estate_property' AND ID LIKE %s", $instance->esc_like($number_to_put_in_like) . '%');    $instance->query($query);    # test_two    $sql = " DELETE wp_posts FROM wp_posts WHERE post_type = 'estate_property' and ID LIKE '442%' ";    $instance->query($sql);}/** * comprobamos que todas las imÃ¡genes entre * avantio y WordPress sean corretas */function borrar_imagenes_no_existen_en_avantio_y_si_en_wordpress(){    $sql = "SELECT post_parent FROM tiendapi_inmobiliaria_dos.wp_postsWHERE post_type = 'attachment'AND post_status = 'publish'AND post_parent IN      (         SELECT ID          FROM tiendapi_inmobiliaria_dos.wp_posts          WHERE post_type = 'estate_property' AND post_status = 'publish'    )    AND post_parent NOT IN    (        SELECT avantio_accomodations        FROM tiendapi_inmobiliaria.avantio_accomodations_pictures        WHERE avantio_accomodations = post_parent         AND uri_900x600 LIKE '%tiendapi_inmobiliaria_dos.post_title%'    ) group by post_parent ";}content_wrapper();function content_wrapper(){    # home    $url =  $_SERVER['SERVER_NAME'] . $_SERVER['REQUEST_URI'];    $root_url =  $_SERVER['SERVER_NAME'];    $arr_url = explode("/", $url);    unset($arr_url[sizeof($arr_url)-1]);    $new_url = implode("/",$arr_url);    if($new_url == $root_url){?>        <style>            .content_wrapper{                width:1170px;                margin: 0px auto;                position: relative;                padding: 0px 0px 30px 0px;                min-height: 800px;                background-color:#fafafa;            }            .elementor-background-overlay{                background-color:#fafafa;                display:none;            }        </style>    <?php }    # home fr en ca    if(strpos($url,"home") !== false){ ?>        <style>            .content_wrapper{                width:1170px;                margin: 0px auto;                position: relative;                padding: 0px 0px 30px 0px;                min-height: 800px;                background-color:#fafafa;            }            .elementor-background-overlay{                background-color:#fafafa;                display:none;            }        </style>        <?php }}function check_page(){    if (is_page_template()){        echo "page_template: <br>";    }    if (is_page()){        echo "page: <br>";    }    if (is_single()){        echo "single: <br>";    }    if (is_singular()){        echo "singular: <br>";    }    /*    echo "el id: " . get_the_ID() . "<br>";    if ( is_singular( 'estate_property' ) ) {        echo "el id: " . get_the_ID() . "<br>";        entorno_y_distancia();    }    echo "el id es: ".get_the_ID()."<br>";    if (is_page()){        echo get_the_ID();        //entorno_y_distancia();    }    */}?>