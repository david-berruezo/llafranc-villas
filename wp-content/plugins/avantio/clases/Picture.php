<?phpclass Picture{    protected $table      = 'dynamic_taxonomy';    protected $primaryKey = 'id';    protected $allowedFields = ['id', 'language','text_title'];    # wordpress    private $post_id;    /**     * @param $xml     * @param $avantio_credentials     */    public function insertPictures($xml,$avantio_credentials)    {        $inserts               = array();        $inserts_gallery_title = array("id","language","zip_status","text_title");        $inserts_gallery_value = array(null,"es",0);        $counter_property = 0;        foreach($xml->Accommodation as $accommodation){            //if($counter_property < 2) {                $avantio_accomodations = intval($accommodation->AccommodationId);                if(get_post_status($avantio_accomodations)) {                    $count = 0;                    $my_post_translation = pll_get_post_translations($avantio_accomodations);                    foreach ($avantio_credentials['ACTIVED_LANGUAGES'] as $lang) {                        $vector_images = array();                        foreach ($accommodation->Pictures->Picture as $picture) {                            $count++;                            //if ($count < 3) {                                # insert and update                                //if (get_post_status($avantio_accomodations)) {                                //echo "avantio_accomodations " .$avantio_accomodations. "<br>";                                //$this->fetch_media((string)$picture->OriginalURI, $avantio_accomodations);                                if (!in_array((string)$picture->AdaptedURI, $vector_images)){                                    array_push($vector_images , (string)$picture->AdaptedURI);                                    $this->insert_property_image((string)$picture->AdaptedURI, $my_post_translation[$lang]);                                }                                // echo "imagen: ".(string)$picture->AdaptedURI."<br>";                                //}// end if                            //}// end if                            /*                            $uri_900x600 = (string)$picture->OriginalURI;                            $uri_650x450 = (string)$picture->AdaptedURI;                            $uri_99x66 = (string)$picture->ThumbnailURI;                            # insert avantio acommodations pictures                            $inserts[] = "('".$count."','".$avantio_accomodations."','".addslashes($uri_900x600)."','".addslashes($uri_650x450)."','".addslashes($uri_99x66)."' , '1')" ;                            # insert dynamic gallery                            $image = "image_".$count;                            $text_title = "text_title_image_".$count;                            $text_alt = "text_alt_image_".$count;                            $image_value = addslashes($uri_900x600);                            $text_title_value = addslashes($uri_900x600);                            $text_alt_value = addslashes($uri_900x600);                            # title                            array_push($inserts_gallery_title , $image);                            array_push($inserts_gallery_title , $text_title);                            array_push($inserts_gallery_title , $text_alt);                            # value                            array_push($inserts_gallery_value , $image_value);                            array_push($inserts_gallery_value , $text_title_value);                            array_push($inserts_gallery_value , $text_alt_value);                            */                        }// end foreach pictures                        $counter_property++;                    }// end foreach languages                } // end if id == 60 ...            //}// end if        }// end foreach    } // end function    /**     * @return mixed     */    public function getPostId()    {        return $this->post_id;    }    /**     * @param mixed $post_id     */    public function setPostId($post_id)    {        $this->post_id = $post_id;    }    //add_action( 'init', 'download_photos' );    function download_photos(){        $file_url = "http://img.crs.itsolutions.es/fotos/2/16296628291f9a869e78ce86803e45e31a397d0922/16296628315df9646ccb34fe99bc422c9273fb12c6.jpg";        $post_id  = 362599;        insert_property_image($file_url, $post_id);    }    function insert_property_image($file_url, $post_id){        require_once(ABSPATH . 'wp-load.php');        require_once(ABSPATH . 'wp-admin/includes/image.php');        global $wpdb;        if(!$post_id) {            return false;        }        // directory to import to        $artDir = 'wp-content/uploads/importedmedia/';        // if the directory doesn't exist, create it        if(!file_exists(ABSPATH.$artDir)) {            mkdir(ABSPATH.$artDir);        }        // rename the file... alternatively, you could explode on "/" and keep the original file name        $name_file = explode("/", $file_url);        $name_file = $name_file[count($name_file)-1];        $name_file = explode(".", $name_file);        $name_file = $name_file[0];        $name_file = substr($name_file,0,strlen($name_file)-1);        $ext = array_pop(explode(".", $file_url));        //$new_filename = 'blogmedia-'.$post_id.".".$ext; //if your post has multiple files, you may need to add a random number to the file name to prevent overwrites        $new_filename = 'blogmedia-'.$name_file.".".$ext; //if your post has multiple files, you may need to add a random number to the file name to prevent overwrites        if (@fclose(@fopen($file_url, "r"))) { //make sure the file actually exists            copy($file_url, ABSPATH.$artDir.$new_filename);            $siteurl = get_option('siteurl');            $file_info = getimagesize(ABSPATH.$artDir.$new_filename);            //create an array of attachment data to insert into wp_posts table            $artdata = array();            $artdata = array(                'post_author' => 1,                'post_date' => current_time('mysql'),                'post_date_gmt' => current_time('mysql'),                'post_title' => $new_filename,                'post_status' => 'inherit',                'comment_status' => 'closed',                'ping_status' => 'closed',                'post_name' => sanitize_title_with_dashes(str_replace("_", "-", $new_filename)),                'post_modified' => current_time('mysql'),                'post_modified_gmt' => current_time('mysql'),                'post_parent' => $post_id,                'post_type' => 'attachment',                'guid' => $siteurl.'/'.$artDir.$new_filename,                'post_mime_type' => $file_info['mime'],                'post_excerpt' => '',                'post_content' => ''            );            $uploads = wp_upload_dir();            $save_path = $uploads['basedir'].'/importedmedia/'.$new_filename;            // insert the database record            $attach_id = wp_insert_attachment( $artdata, $save_path, $post_id );            // generate metadata and thumbnails            if ($attach_data = wp_generate_attachment_metadata( $attach_id, $save_path)) {                wp_update_attachment_metadata($attach_id, $attach_data);            }            // optional make it the featured image of the post it's attached to            $rows_affected = $wpdb->insert($wpdb->prefix.'postmeta', array('post_id' => $post_id, 'meta_key' => '_thumbnail_id', 'meta_value' => $attach_id));            set_post_thumbnail( $post_id, $attach_id );        } else {            return false;        }        return true;    }    /*    function fetch_media($file_url, $post_id) {        $my_file_url = $file_url;        require_once(ABSPATH . 'wp-load.php');        require_once(ABSPATH . 'wp-admin/includes/image.php');        global $wpdb;        if(!$post_id) {            return false;        }        // directory to import to        $artDir = 'wp-content/uploads/importedmedia/';        //$artDir = '/home/automocion/public_html/wp-content/uploads/importedmedia/';        // if the directory doesn't exist, create it        if(!file_exists(ABSPATH.$artDir)) {            mkdir(ABSPATH.$artDir);        }        // rename the file... alternatively, you could explode on "/" and keep the original file name        $prueba = explode(".", $my_file_url);        $ext = array_pop($prueba);        $new_filename = 'blogmedia-'.$post_id.".".$ext; //if your post has multiple files, you may need to add a random number to the file name to prevent overwrites        //echo $new_filename."<br>";        //echo $file_url."<br>";        if (@fclose(@fopen($my_file_url, "r"))) { //make sure the file actually exists            //echo "esta entrando<br>";            copy($my_file_url, ABSPATH.$artDir.$new_filename);            $siteurl = get_option('siteurl');            $file_info = getimagesize(ABSPATH.$artDir.$new_filename);            //create an array of attachment data to insert into wp_posts table            $artdata = array();            $artdata = array(                'post_author' => 1,                'post_date' => current_time('mysql'),                'post_date_gmt' => current_time('mysql'),                'post_title' => $new_filename,                'post_status' => 'inherit',                'comment_status' => 'closed',                'ping_status' => 'closed',                'post_name' => sanitize_title_with_dashes(str_replace("_", "-", $new_filename)),                'post_modified' => current_time('mysql'),                'post_modified_gmt' => current_time('mysql'),                'post_parent' => $post_id,                'post_type' => 'attachment',                'guid' => $siteurl.'/'.$artDir.$new_filename,                'post_mime_type' => $file_info['mime'],                'post_excerpt' => '',                'post_content' => ''            );            $uploads = wp_upload_dir();            $save_path = $uploads['basedir'].'/importedmedia/'.$new_filename;            //echo "save_path: ".$save_path."<br>";            //insert the database record            $attach_id = wp_insert_attachment( $artdata, $save_path, $post_id );            // generate metadata and thumbnails            if ($attach_data = wp_generate_attachment_metadata( $attach_id, $save_path)) {                wp_update_attachment_metadata($attach_id, $attach_data);            }            // optional make it the featured image of the post it's attached to            $rows_affected = $wpdb->insert($wpdb->prefix.'postmeta', array('post_id' => $post_id, 'meta_key' => '_thumbnail_id', 'meta_value' => $attach_id));            set_post_thumbnail( $post_id, $attach_id );        } else {            return false;        }        return true;    }    */    private function add_two_primary_keys()    {        $forge = \Config\Database::forge();        $forge->addKey('id', TRUE);        $forge->addKey('language', TRUE);    } // end function    private function insertar_actualizar()    {        $data = [            'id'            => "",            'language'      => "",            'text_title'    => ""        ];        $this->save($data);    } // end function}// end class?>