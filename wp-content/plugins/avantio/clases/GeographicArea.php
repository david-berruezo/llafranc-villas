<?phpclass GeographicArea{    protected $table      = 'dynamic_geocountry';    protected $primaryKey = 'id';    protected $allowedFields = ['id', 'language','text_title'];    private $vector_found = array(        "Not s",        "Non s",        "Sin e",        "Not specified",        "Sin especificar",    );    # wordpress    private $post_id;    public function insertGeographicAreas($xml,$avantio_credentials)    {        $wpdb = Database::getInstance();        # term_vector        $term_vector = array();        $term_vector_region = array();        $term_vector_city = array();        $term_vector_locality = array();        $term_vector_district = array();        # max elements        $max_elements_region = 0;        $max_elements_city = 0;        $max_elements_locality = 0;        $max_elements_district = 0;        $max_elements_ = 0;        # create taxonomy        $this->create_taxonomy_property_city();        $this->create_taxonomy_property_area();        # countries seleccionados        $vector_id_countries = array(1);        foreach($xml->InternationalizedItem as $country){            $lang = (string)$country->Language;            # elements            $counter_element_region = 0;            $counter_element_city = 0;            $counter_element_locality = 0;            $counter_element_district = 0;            $counter_element_ = 0;            $counter = 0;            # check language and country name in Spanish and English            if(!in_array($lang,$avantio_credentials['ACTIVED_LANGUAGES'])) continue;            $country_name = (string)$country->Countries->Country->Name;            $country_id = intval($country->Countries->Country->CountryCode);            # geocountry | spain  && $country_name == "Spain" || in_array($country_id,$vector_id_countries) && $country_name == "España"            if (in_array($country_id,$vector_id_countries)){                echo "lenguage: " .$lang. "<br>";            foreach($country->Countries->Country->Regions->Region as $region){                //if($counter < 1) {                    # name and id                    $mkind_id = intval($region->RegionCode);                    $mking_name = (String)$region->Name . "-" . $lang;                    $my_cat = array(                        'description' => $mking_name,                        'slug' => sanitize_title($mking_name),                        'parent' => 0                    );                    $term_vector_region[$lang][$counter_element_region] = term_exists($mking_name, 'property_city', $my_cat);                    if (!$term_vector_region[$lang][$counter_element_region]) {                        $term_vector_region[$lang][$counter_element_region] = wp_insert_term($mking_name, 'property_city', $my_cat);                        //my_print($term_vector_region[$lang][$counter_element_region]);                        pll_set_term_language($term_vector_region[$lang][$counter_element_region]["term_id"], $lang);                    } else {                        pll_set_term_language($term_vector_region[$lang][$counter_element_region]["term_id"], $lang);                    }                    # change name                    $word = "-" . $lang;                    $final_name = str_replace($word, "", $mking_name);                    $args = array('name' => $final_name, 'description' => $final_name);                    //print_r($args);                    wp_update_term($term_vector_region[$lang][$counter_element_region]["term_id"], 'property_city', $args);                    # add option save cityparent category_fetured_image and others                    $term_data = array(                        "pagetax" => "",                        "category_featured_image" => "http://localhost/brava_rentals/wp-content/uploads/importedmedia/blogmedia-361789.jpg",                        "category_tax" => "property_city"                    );                    /*                    if(is_array($region_term))                        $taxonomy = "taxonomy_".$region_term["term_id"];                    if(is_object($region_term))                        $taxonomy = "taxonomy_".$region_term->term_id;                    */                    if (is_array($term_vector_region[$lang][$counter_element_region]))                        $taxonomy = "taxonomy_" . $term_vector_region[$lang][$counter_element_region]["term_id"];                    if (is_object($term_vector_region[$lang][$counter_element_region]))                        $taxonomy = "taxonomy_" . $term_vector_region[$lang][$counter_element_region]->term_id;                    $return = add_option($taxonomy, $term_data, $deprecated = '', $autoload = 'yes');                    $counter_element_region++;                    # city                    foreach ($region->Cities->City as $city) {                        # name and id                        $mkind_id = intval($city->CityCode);                        $mking_name = (string)$city->Name . "-" . $lang;                        $my_cat = array(                            'description' => $mking_name,                            'slug' => sanitize_title($mking_name),                            'parent' => (is_object($term_vector_region[$lang][$counter_element_region - 1])) ? $term_vector_region[$lang][$counter_element_region - 1]->term_id : $term_vector_region[$lang][$counter_element_region - 1]["term_id"]                        );                        $term_vector_city[$lang][$counter_element_city] = term_exists($mking_name, 'property_city', $my_cat);                        if (!$term_vector_city[$lang][$counter_element_city]) {                            $term_vector_city[$lang][$counter_element_city] = wp_insert_term($mking_name, 'property_city', $my_cat);                            //my_print($term_vector_city[$lang][$counter_element_city]);                            pll_set_term_language($term_vector_city[$lang][$counter_element_city]["term_id"], $lang);                        } else {                            pll_set_term_language($term_vector_city[$lang][$counter_element_city]["term_id"], $lang);                        }                        # change name                        $word = "-" . $lang;                        $final_name = str_replace($word, "", $mking_name);                        $args = array('name' => $final_name, 'description' => $final_name);                        //print_r($args);                        wp_update_term($term_vector_city[$lang][$counter_element_city]["term_id"], 'property_city', $args);                        # add option save cityparent category_fetured_image and others                        $term_data = array(                            "pagetax" => "",                            "category_featured_image" => "http://localhost/brava_rentals/wp-content/uploads/importedmedia/blogmedia-361789.jpg",                            "category_tax" => "property_city"                        );                        if (is_array($term_vector_city[$lang][$counter_element_city]))                            $taxonomy = "taxonomy_" . $term_vector_city[$lang][$counter_element_city]["term_id"];                        if (is_object($term_vector_city[$lang][$counter_element_city]))                            $taxonomy = "taxonomy_" . $term_vector_city[$lang][$counter_element_city]->term_id;                        $return = add_option($taxonomy, $term_data, $deprecated = '', $autoload = 'yes');                        $counter_element_city++;                        /*                        $city_name = (string)$city->Name;                        $city_id = intval($city->CityCode);                        # insert term if not exist | update term if exist and parent                        $actions = array(                            $city_name                        );                        foreach ($actions as $key) {                            $my_cat = array(                                'description' => $key,                                'slug' =>sanitize_title($key),                                'parent' => (is_object($region_term)) ? $region_term->term_id : $region_term["term_id"]                            );                            $my_term_id = term_exists($key, 'property_city', $my_cat);                            if(!$my_term_id){                                $city_term =  wp_insert_term($key, 'property_city', $my_cat);                            }else{                                $city_term =  get_term($my_term_id["term_id"],'property_city' , 'array');                                $city_term->parent = $region_term->term_id;                                wp_update_term( $city_term->term_id,'property_city', $args = array() );                            }                        }                        # add option save cityparent category_fetured_image and others                        $term_data = array(                            "pagetax" => "",                            "category_featured_image" => "http://localhost/brava_rentals/wp-content/uploads/importedmedia/blogmedia-361789.jpg",                            "category_tax" => "property_city"                        );                        if(is_array($city_term))                            $taxonomy = "taxonomy_".$city_term["term_id"];                        if(is_object($city_term))                            $taxonomy = "taxonomy_".$city_term->term_id;                        $return = add_option($taxonomy, $term_data, $deprecated = '', $autoload = 'yes' );                        */                        # locality                        foreach ($city->Localities->Locality as $locality) {                            # name and id                            $mkind_id = intval($locality->LocalityCode);                            $mking_name = (string)$locality->Name . "-" . $lang;                            $my_cat = array(                                'description' => $mking_name,                                'slug' => sanitize_title($mking_name),                                'parent' => 0                            );                            $term_vector_locality[$lang][$counter_element_locality] = term_exists($mking_name, 'property_area', $my_cat);                            if (!$term_vector_locality[$lang][$counter_element_locality]) {                                $term_vector_locality[$lang][$counter_element_locality] = wp_insert_term($mking_name, 'property_area', $my_cat);                                //my_print($term_vector_locality[$lang][$counter_element_locality]);                                pll_set_term_language($term_vector_locality[$lang][$counter_element_locality]["term_id"], $lang);                            } else {                                pll_set_term_language($term_vector_locality[$lang][$counter_element_locality]["term_id"], $lang);                            }                            # change name                            $word = "-" . $lang;                            $final_name = str_replace($word, "", $mking_name);                            $args = array('name' => $final_name, 'description' => $final_name);                            //print_r($args);                            wp_update_term($term_vector_locality[$lang][$counter_element_locality]["term_id"], 'property_area', $args);                            # add option save cityparent category_fetured_image and others                            $term_data = array(                                "pagetax" => "",                                "category_featured_image" => "http://localhost/brava_rentals/wp-content/uploads/importedmedia/blogmedia-361789.jpg",                                "category_tax" => "property_area"                            );                            if (is_array($term_vector_locality[$lang][$counter_element_locality]))                                $taxonomy = "taxonomy_" . $term_vector_locality[$lang][$counter_element_locality]["term_id"];                            if (is_object($term_vector_locality[$lang][$counter_element_locality]))                                $taxonomy = "taxonomy_" . $term_vector_locality[$lang][$counter_element_locality]->term_id;                            $return = add_option($taxonomy, $term_data, $deprecated = '', $autoload = 'yes');                            $counter_element_locality++;                            /*                            $locality_name = (string)$locality->Name;                            $locality_id = intval($locality->LocalityCode);                            # insert term if not exist | update term if exist and parent                            $actions = array(                                $locality_name                            );                            foreach ($actions as $key) {                                $my_cat = array(                                    'description' => $key,                                    'slug' =>sanitize_title($key)                                );                                $my_term_id = term_exists($key, 'property_area', $my_cat);                                if(!$my_term_id){                                    $area_term = wp_insert_term($key, 'property_area', $my_cat);                                }else{                                    $area_term =  get_term($my_term_id["term_id"],'property_area' , 'array');                                }                            }                            $area_parent = $area_term;                            # add option save cityparent category_fetured_image and others                            $term_data = array(                                "cityparent" => $city_name,                                "pagetax" => "",                                "category_featured_image" => "http://localhost/brava_rentals/wp-content/uploads/importedmedia/blogmedia-361789.jpg",                                "category_tax" => "property_area"                            );                            if(is_array($area_term))                                $taxonomy = "taxonomy_".$area_term["term_id"];                            if(is_object($area_term))                                $taxonomy = "taxonomy_".$area_term->term_id;                            $return = add_option($taxonomy, $term_data, $deprecated = '', $autoload = 'yes' );                            */                            # district                            foreach ($locality->Districts->District as $district) {                                if (!in_array($district->Name, $this->vector_found)) {                                    if (strpos((string)$district->Name, "Sin especificar") !== true && strpos((string)$district->Name, "Not specified") !== true && strpos((string)$district->Name, "Not specified") !== true && (string)$district->Name != "") {                                        # name and id                                        $mkind_id = intval($district->DistrictCode);                                        $mking_name = (string)$district->Name . "-" . $lang;                                        $my_cat = array(                                            'description' => $mking_name,                                            'slug' => sanitize_title($mking_name),                                            'parent' => (is_object($term_vector_locality[$lang][$counter_element_locality - 1])) ? $term_vector_locality[$lang][$counter_element_locality - 1]->term_id : $term_vector_locality[$lang][$counter_element_locality - 1]["term_id"]                                        );                                        //my_print($my_cat);                                        $term_vector_district[$lang][$counter_element_district] = term_exists($mking_name, 'property_area', $my_cat);                                        if (!$term_vector_district[$lang][$counter_element_district]) {                                            $term_vector_district[$lang][$counter_element_district] = wp_insert_term($mking_name, 'property_area', $my_cat);                                            //my_print($term_vector_district[$lang][$counter_element_district]);                                            pll_set_term_language($term_vector_district[$lang][$counter_element_district]["term_id"], $lang);                                        } else {                                            pll_set_term_language($term_vector_district[$lang][$counter_element_district]["term_id"], $lang);                                        }                                        # change name                                        $word = "-" . $lang;                                        $final_name = str_replace($word, "", $mking_name);                                        $args = array('name' => $final_name, 'description' => $final_name);                                        //print_r($args);                                        wp_update_term($term_vector_district[$lang][$counter_element_district]["term_id"], 'property_area', $args);                                        /*                                        $term_vector_locality[$lang][$counter_element_locality] = term_exists($mking_name, 'property_area',$my_cat);                                        if(!$term_vector_locality[$lang][$counter_element_locality] ){                                            $term_vector_locality[$lang][$counter_element_locality] = wp_insert_term($mking_name, 'property_area',$my_cat);                                            //my_print($term_vector_locality[$lang][$counter_element_locality]);                                            pll_set_term_language($term_vector_locality[$lang][$counter_element_locality]["term_id"], $lang);                                        }else{                                            pll_set_term_language($term_vector_locality[$lang][$counter_element_locality]["term_id"], $lang);                                        }                                        */                                        # add option save cityparent category_fetured_image and others                                        $term_data = array(                                            "pagetax" => "",                                            "category_featured_image" => "http://localhost/brava_rentals/wp-content/uploads/importedmedia/blogmedia-361789.jpg",                                            "category_tax" => "property_area"                                        );                                        if (is_array($term_vector_district[$lang][$counter_element_district]))                                            $taxonomy = "taxonomy_" . $term_vector_district[$lang][$counter_element_district]["term_id"];                                        if (is_object($term_vector_district[$lang][$counter_element_district]))                                            $taxonomy = "taxonomy_" . $term_vector_district[$lang][$counter_element_district]->term_id;                                        $return = add_option($taxonomy, $term_data, $deprecated = '', $autoload = 'yes');                                        $counter_element_district++;                                        /*                                        $district_name = (string)$district->Name;                                        $district_id = intval($district->DistrictCode);                                        $district_postal_code = intval($district->PostalCode);                                        # insert term if not exist | update term if exist and parent                                        $actions = array(                                            $district_name                                        );                                        foreach ($actions as $key) {                                            $my_cat = array(                                                'description' => $key,                                                'slug' =>sanitize_title($key),                                                'parent' => (is_object($area_parent)) ? $area_parent->term_id : $area_parent["term_id"]                                            );                                            $my_term_id = term_exists($key, 'property_area', $my_cat);                                            if(!$my_term_id){                                                $area_term = wp_insert_term($key, 'property_area', $my_cat);                                            }else{                                                $area_term =  get_term($my_term_id["term_id"],'property_area' , 'array');                                                wp_update_term( $area_term->term_id,'property_area', $args = array() );                                            }                                        }                                        # add option save cityparent category_fetured_image and others                                        $term_data = array(                                            "cityparent" => $city_name,                                            "pagetax" => "",                                            "category_featured_image" => "http://localhost/brava_rentals/wp-content/uploads/importedmedia/blogmedia-361789.jpg",                                            "category_tax" => "property_area"                                        );                                        if(is_array($area_term))                                            $taxonomy = "taxonomy_".$area_term["term_id"];                                        if(is_object($area_term))                                            $taxonomy = "taxonomy_".$area_term->term_id;                                        $return = add_option($taxonomy, $term_data, $deprecated = '', $autoload = 'yes' );                                        */                                    }// end if                                } // end if                            }// end foreach                        }// end foreach                    }// end foreach                //}// end if counter                $counter++;                if($counter_element_region > $max_elements_region)                    $max_elements_region = $counter_element_region;                if($counter_element_city > $max_elements_city)                    $max_elements_city = $counter_element_city;                if($counter_element_locality > $max_elements_locality)                    $max_elements_locality = $counter_element_locality;                if($counter_element_district > $max_elements_district)                    $max_elements_district = $counter_element_district;            }// end foreach region            }// end if country        }// end foreach internationalized        echo "region: ".$max_elements_region."<br>";        # region        for($i = 0; $i < $max_elements_region; $i++) {            $vector_plantilla = array();            for($j = 0; $j < count($avantio_credentials['ACTIVED_LANGUAGES']); $j++) {                $lang = $avantio_credentials['ACTIVED_LANGUAGES'][$j];                $vector_plantilla[$lang] = $term_vector_region[$lang][$i]["term_id"];            }// end for            pll_save_term_translations($vector_plantilla);            //my_print($vector_plantilla);        }// end for        # city        for($i = 0; $i < $max_elements_city; $i++) {            $vector_plantilla = array();            for($j = 0; $j < count($avantio_credentials['ACTIVED_LANGUAGES']); $j++) {                $lang = $avantio_credentials['ACTIVED_LANGUAGES'][$j];                $vector_plantilla[$lang] = $term_vector_city[$lang][$i]["term_id"];            }// end for            pll_save_term_translations($vector_plantilla);            //my_print($vector_plantilla);        }// end for        # locality        for($i = 0; $i < $max_elements_locality; $i++) {            $vector_plantilla = array();            for($j = 0; $j < count($avantio_credentials['ACTIVED_LANGUAGES']); $j++) {                $lang = $avantio_credentials['ACTIVED_LANGUAGES'][$j];                $vector_plantilla[$lang] = $term_vector_locality[$lang][$i]["term_id"];            }// end for            pll_save_term_translations($vector_plantilla);            //my_print($vector_plantilla);        }// end for        # district        for($i = 0; $i < $max_elements_district; $i++) {            $vector_plantilla = array();            for($j = 0; $j < count($avantio_credentials['ACTIVED_LANGUAGES']); $j++) {                $lang = $avantio_credentials['ACTIVED_LANGUAGES'][$j];                $vector_plantilla[$lang] = $term_vector_district[$lang][$i]["term_id"];            }// end for            pll_save_term_translations($vector_plantilla);            //my_print($vector_plantilla);        }// end for    } // end function    private function create_taxonomy_property_city()    {        $slug = 'property_city';        // add custom taxonomy        register_taxonomy('property_city', 'estate_property', array(                'labels' => array(                    'name' => esc_html__('City', 'wprentals-core'),                    'add_new_item' => esc_html__('Add New City', 'wprentals-core'),                    'new_item_name' => esc_html__('New City', 'wprentals-core')                ),                'hierarchical' => true,                'query_var' => true,                'rewrite' => array('slug' => $slug)            )        );    } // end function    private function create_taxonomy_property_area()    {        $slug = 'property_area';        // add custom taxonomy        register_taxonomy('property_area', 'estate_property', array(                'labels' => array(                    'name'              => esc_html__( 'Neighborhood / Area','wprentals-core'),                    'add_new_item'      => esc_html__( 'Add New Neighborhood / Area','wprentals-core'),                    'new_item_name'     => esc_html__( 'New Neighborhood / Area','wprentals-core')                ),                'hierarchical'  => true,                'query_var'     => true,                'rewrite'       => array( 'slug' => $slug )            )        );    } // end function    /**     * @param $localityName     * @return string     */    private function getLocalitiesImages($localityId)    {        $image = "";        switch($localityId){            case 1: $image = "https://2automocion.com/wp-content/uploads/2021/10/22-1-scaled.jpg";                break;            case 2: $image = "https://2automocion.com/wp-content/uploads/2021/10/23-1-scaled.jpg";                break;            case 3: $image = "https://2automocion.com/wp-content/uploads/2021/10/Vidreres-1-scaled.jpg";                break;            case 4: $image = "https://2automocion.com/wp-content/uploads/2021/10/Torrella-de-Montgri-scaled.jpg";                break;            case 5: $image = "https://2automocion.com/wp-content/uploads/2021/10/Tamariu-scaled.jpg";                break;            case 6: $image = "https://2automocion.com/wp-content/uploads/2021/10/Pals-1-scaled.jpg";                break;            case 7: $image = "https://2automocion.com/wp-content/uploads/2021/10/LLoret-de-Mar-scaled.jpg";                break;            case 8: $image = "https://2automocion.com/wp-content/uploads/2021/10/Esclanyá-scaled.jpg";                break;            case 9: $image = "https://2automocion.com/wp-content/uploads/2021/10/Canyelles-scaled.jpg";                break;            case 10: $image = "https://2automocion.com/wp-content/uploads/2021/10/Calella-de-Palafrugell-scaled.jpg";                break;            case 11: $image = "https://2automocion.com/wp-content/uploads/2021/10/Blanes-scaled.jpg";                break;        }// end switch        /*        switch($localityId){            case "Palafrugell": $image = "https://2automocion.com/wp-content/uploads/2021/10/22-1-scaled.jpg";                break;            case "Llafranc": $image = "https://2automocion.com/wp-content/uploads/2021/10/23-1-scaled.jpg";                break;            case "Vidreres": $image = "https://2automocion.com/wp-content/uploads/2021/10/Vidreres-1-scaled.jpg";                break;            case "Torrella de Montgri": $image = "https://2automocion.com/wp-content/uploads/2021/10/Torrella-de-Montgri-scaled.jpg";                break;            case "Tamariu": $image = "https://2automocion.com/wp-content/uploads/2021/10/Tamariu-scaled.jpg";                break;            case "Pals": $image = "https://2automocion.com/wp-content/uploads/2021/10/Pals-1-scaled.jpg";                break;            case "Lloret de mar": $image = "https://2automocion.com/wp-content/uploads/2021/10/LLoret-de-Mar-scaled.jpg";                break;            case "Esclanyà": $image = "https://2automocion.com/wp-content/uploads/2021/10/Esclanyá-scaled.jpg";                break;            case "Canyelles": $image = "https://2automocion.com/wp-content/uploads/2021/10/Canyelles-scaled.jpg";                break;            case "Calella de Palafrugell": $image = "https://2automocion.com/wp-content/uploads/2021/10/Calella-de-Palafrugell-scaled.jpg";                break;            case "Blanes": $image = "https://2automocion.com/wp-content/uploads/2021/10/Blanes-scaled.jpg";                break;        }// end switch        */        return $image;    } // end function    private function add_two_primary_keys()    {        $forge = \Config\Database::forge();        $forge->addKey('id', TRUE);        $forge->addKey('language', TRUE);    } // end function    private function insertar_actualizar()    {        $data = [            'id'            => "",            'language'      => "",            'text_title'    => ""        ];        $this->save($data);    } // end function}// end class?>